---
import { getSecret } from 'astro:env/server';
import CopyBlock from './CopyBlock.astro';
import { initiateDeveloperControlledWalletsClient } from "@circle-fin/developer-controlled-wallets";

interface Wallet {
  refId: string;
  blockchain: string;
  address: string;
}

const secretsConfigured = Boolean( getSecret('API_KEY')) && Boolean(getSecret('ENTITY_SECRET'));

const client = initiateDeveloperControlledWalletsClient({
  apiKey: `${getSecret("API_KEY")}`,
  entitySecret: `${getSecret("ENTITY_SECRET")}`,
});

const { walletSetId } = Astro.props;

const response = await client.listWallets({
  walletSetId: walletSetId,
});
const wallets = (response.data?.wallets || []) as Wallet[];
---

<table>
  <thead>
    <tr>
      <th>refId</th>
      <th>Blockchain</th>
      <th>Wallet Address</th>
    </tr>
  </thead>
  {secretsConfigured &&
  <tbody>
    {wallets
      .filter((wallet: Wallet) => wallet.refId?.startsWith('order-'))
      .map((wallet: Wallet) => (
      <tr>
        <td><CopyBlock source={wallet.refId} /></td>
        <td>{wallet.blockchain}</td>
        <td><CopyBlock source={wallet.address} /></td>
      </tr>
    ))}
  </tbody>
  }
</table>

<style>
  table {
    max-width: 100%;
    font-size: var(--step--1);
  }

  th {
    background-color: #555;
    color: #fff;
  }

  th,
  td {
    text-align: left;
    padding: 0.5em 1em;
    white-space: nowrap;
  }

  td::before {
    display: none;
  }

@media screen and (max-width: 680px) {
  table {
    border: 0;
    display: block;
    box-shadow: none;
  }

  thead {
    position: absolute;
    opacity: 0;
  }
    
  tbody {
    display: block;
    min-width: 19em;
    max-width: 25em;
  }

  tr {
    border-top: 2px solid #3c3c3b;
    border-bottom: 2px solid #3c3c3b;
    display: block;
    margin-bottom: 1em;
  }

  td {
    border-bottom: 1px solid #3c3c3b;
    display: flex;
  }

  td::before {
    display: inline-block;
    font-weight: bold;
    margin-right: auto;
    padding-right: 1em;
  }

  td:last-child {
    border-bottom: 0;
  }
}
</style>
