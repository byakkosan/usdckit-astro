---
import CopyBlock from './CopyBlock.astro';
import { JSONFilePreset } from 'lowdb/node';

type Data = {
  merchants: { name: string; id: string; walletAddress: string }[]
}

const defaultData: Data = { merchants: [] };
const db = await JSONFilePreset<Data>('./src/db/db.json', defaultData);
const merchants = db.data.merchants;
---

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Wallet Address</th>
    </tr>
  </thead>
  <tbody>
    {merchants.length > 0 ? (
      merchants.map((merchant) => (
        <tr>
          <td>{merchant.id}</td>
          <td><a href={`/merchants/${merchant.id}`}>{merchant.name}</a></td>
          <td><CopyBlock source={merchant.walletAddress} /></td>
        </tr>
      ))
    ) : (
      <tr>
        <td colspan="3">No merchants found</td>
      </tr>
    )}
  </tbody>
</table>

<style>
  table {
    max-width: 100%;
    font-size: var(--step--1);
  }

  th {
    background-color: #555;
    color: #fff;
  }

  th,
  td {
    text-align: left;
    padding: 0.5em 1em;
    white-space: nowrap;
  }

  td::before {
    display: none;
  }

@media screen and (max-width: 680px) {
  table {
    border: 0;
    display: block;
    box-shadow: none;
  }

  thead {
    position: absolute;
    opacity: 0;
  }
    
  tbody {
    display: block;
    min-width: 19em;
    max-width: 25em;
  }

  tr {
    border-top: 2px solid #3c3c3b;
    border-bottom: 2px solid #3c3c3b;
    display: block;
    margin-bottom: 1em;
  }

  td {
    border-bottom: 1px solid #3c3c3b;
    display: flex;
  }

  td::before {
    display: inline-block;
    font-weight: bold;
    margin-right: auto;
    padding-right: 1em;
  }

  td:last-child {
    border-bottom: 0;
  }
}
</style>
